<!DOCTYPE html><html lang="tr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Unpacking pyarmor - Soder CTF | anal.school</title><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Unpacking pyarmor - Soder CTF | anal.school"><meta name="twitter:description" content="bir çeşit ilim evi"><meta name="twitter:image" content="https://anal.school/img/twit-banner.webp"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-118381182-2"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-118381182-2');</script><link rel="stylesheet" href="/css/arknights.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.1.2/styles/atom-one-dark-reasonable.min.css"><style>@font-face {
 font-family: BenderLight;
 src: local('Bender'), url("/font/BenderLight.ttf");
 font-display: swap;
}
@font-face {
 font-family: 'JetBrains Mono';
 src: local('JetBrains Mono'), url('/font/JetBrainsMono-Regular.woff2') format('woff2');
 font-display: swap;
}</style><meta name="generator" content="Hexo 5.2.0"></head><body><header><nav><a href="/">Home</a><a href="/archives/">Archives</a><a href="/about/">About</a></nav></header><main><article><div id="post-bg"><div id="post-title"><div id="post-info"><span>date:<time datetime="2020-07-29T22:29:22.000Z" id="date"> 2020-07-30</time></span><br><span>updated:<time datetime="2020-12-08T12:08:39.437Z" id="updated"> 2020-12-08</time></span></div><h1>Unpacking pyarmor - Soder CTF</h1><hr></div><div id="post-content"><p>el konulan kitabim Introduction to Computer Theory’in namusunu kurtarmak icin yazilan bir yazi. temelde packli pyarmor uygulamasini unpack eylemeyi anlatmaktadir.</p>
<h2 id="analiz"><a href="#analiz" class="headerlink" title="analiz"></a>analiz</h2><p>program calisitirildigi vakit cikti vermiyor.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> ./SierraTwo_V2.exe</span><br></code></pre></td></tr></table></figure>
<p>hizlica bilindik bir string var mi diye kontrol etmek icin hata mesajlari icin ufak bir grep atmak bazen iyi bir fikir olabilir.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">[0x140008b14]&gt;</span><span class="bash"> iz ~ Err</span><br>1    0x00021df8 0x1400233f8 38   39   .rdata  ascii   Error allocating decompression buffer\n<br>3    0x00021e28 0x140023428 26   27   .rdata  ascii   Error %d from inflate: %s\n<br>4    0x00021e48 0x140023448 30   31   .rdata  ascii   Error %d from inflateInit: %s\n<br>8    0x00021ec8 0x1400234c8 23   24   .rdata  ascii   Error decompressing %s\n<br>18   0x00021fa0 0x1400235a0 15   16   .rdata  ascii   Error on file\n.<br>21   0x00021fc8 0x1400235c8 35   36   .rdata  ascii   Error allocating memory for status\n<br>23   0x00022010 0x140023610 25   26   .rdata  ascii   Error opening archive %s\n<br>25   0x00022040 0x140023640 17   18   .rdata  ascii   Error copying %s\n<br>31   0x000220a8 0x1400236a8 20   21   .rdata  ascii   Error extracting %s\n<br>142  0x00022f38 0x140024538 31   32   .rdata  ascii   Error loading Python DLL &#x27;%s&#x27;.\n<br>154  0x00023110 0x140024710 34   35   .rdata  ascii   Error detected starting Python VM.<br>173  0x00023310 0x140024910 30   31   .rdata  ascii   Error creating child process!\n<br></code></pre></td></tr></table></figure>

<p>142 numarali string bize bunun pyinstaller oldugunu dusundurdu.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">[0x140008b14]&gt;</span><span class="bash"> iz ~ PyInstaller</span><br>177  0x00023370 0x140024970 35   36   .rdata  ascii   PyInstaller: FormatMessageW failed.<br>178  0x00023398 0x140024998 44   45   .rdata  ascii   PyInstaller: pyi_win32_utils_to_utf8 failed.<br></code></pre></td></tr></table></figure>
<p>tahminimizde dogru ciktik. yani yanilmiyormusuz. pyinstaller kullaniyor ise <a target="_blank" rel="noopener" href="https://github.com/extremecoders-re/pyinstxtractor"><code>pyinstxtractor</code></a> yardimi ile icindeki <a target="_blank" rel="noopener" href="https://www.python.org/dev/peps/pep-3147/">pyc</a> dosylarini edinebiliriz.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> python3.8 pyinstxtractor.py SierraTwo_V2.exe</span><br>[+] Processing SierraTwo_V2.exe<br>[+] Pyinstaller version: 2.1+<br>[+] Python version: 38<br>[+] Length of package: 10795430 bytes<br>[+] Found 976 files in CArchive<br>[+] Beginning extraction...please standby<br>[+] Possible entry point: pyiboot01_bootstrap.pyc<br>[+] Possible entry point: pyi_rth__tkinter.pyc<br>[+] Possible entry point: pyi_rth_multiprocessing.pyc<br>[+] Possible entry point: SierraTwo.pyc<br>[+] Found 399 files in PYZ archive<br>[+] Successfully extracted pyinstaller archive: SierraTwo_V2.exe<br><br>You can now use a python decompiler on the pyc files within the extracted directory<br></code></pre></td></tr></table></figure>

<p>cikarttigimmiz dosyayi calistirmak istedigimiz vakit <strong>pytransform</strong> modulunu bulamadigini belirtiyor.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs shell">SierraTwo_V2.exe_extracted&gt; python3.8 SierraTwo.pyc<br>Traceback (most recent call last):<br>  File &quot;dist\obf\SierraTwo.py&quot;, line 2, in &lt;module&gt;<br>ModuleNotFoundError: No module named &#x27;pytransform&#x27;<br></code></pre></td></tr></table></figure>

<p><strong>pytransform</strong> ismi aslinda tanidik bir isim. python bytecode packeri olan pyarmor’a ait runtime kutuphanesinin adi. bunu hizlica grepleyip teyit etme imkanimiz bulunmakta.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash">&gt; grep -rn pyarmor</span><br>Binary file PYZ-00.pyz_extracted/config.pyc matches<br>Binary file PYZ-00.pyz_extracted/pytransform.pyc matches<br>Binary file SierraTwo.pyc matches<br>Binary file _pytransform.dll matches<br></code></pre></td></tr></table></figure>

<h2 id="aksiyon-alimi"><a href="#aksiyon-alimi" class="headerlink" title="aksiyon alimi"></a>aksiyon alimi</h2><p>kendi <a target="_blank" rel="noopener" href="https://pyarmor.readthedocs.io/en/latest/how-to-do.html">dokumantasyonlarinda</a> bulunan dosya hiyerarsisini olusturarak ise koyulabiliriz. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs plain">SierraTwo.pyc<br>pytransform&#x2F;<br>    __init__.py<br>    _pytransform.so<br></code></pre></td></tr></table></figure>

<p><strong><strong>init</strong>.py</strong> dosyasini ise pyinstallerdan cikan <strong>pytransform.pyc</strong> ile degistirecegiz.</p>
<p>simdi dosyamizi calsitirabiliyor olmamiz gerekiyor.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash">&gt; python3.8 .\SierraTwo.pyc</span><br>Traceback (most recent call last):<br>  File &quot;&lt;dist\obf\SierraTwo.py&gt;&quot;, line 4, in &lt;module&gt;<br>  File &quot;&lt;frozen SierraTwo&gt;&quot;, line 21, in &lt;module&gt;<br>ModuleNotFoundError: No module named &#x27;slack&#x27;<br></code></pre></td></tr></table></figure>

<p>cok sansliyiz ki kutuphane bagimli bir kod cikti. <strong>kutuphane bagimliligi</strong> = <strong>library hijacking</strong> slack.py diye bir dosya olusturup icine istedigimiz icerigi koyabiliriz.<br>oncelikle import edildigimizden dolayi callstack’te alakali frame’e gidip etrafi yoklamamiz gerekiyor. bundan dolayi oncelik ile frameleri yoklayalim.<br>burada bilgilendirici olsun diye inspect ile yapiyorum yoksa <strong>import pdb; pdb.set_trace()</strong> denilip bir pdb shelli spawnlanabilir.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> inspect<br><br><span class="hljs-keyword">for</span> frameinfo <span class="hljs-keyword">in</span> inspect.stack():<br>    print(frameinfo.frame)<br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">&lt;frame at <span class="hljs-number">0x000001FA7D4BB1E0</span>, file <span class="hljs-string">&#x27;asykrem\\slack.py&#x27;</span>, line <span class="hljs-number">7</span>, code &lt;module&gt;&gt;<br>&lt;frame at <span class="hljs-number">0x000001FA7D497550</span>, file <span class="hljs-string">&#x27;&lt;frozen importlib._bootstrap&gt;&#x27;</span>, line <span class="hljs-number">219</span>, code _call_with_frames_removed&gt;<br>&lt;frame at <span class="hljs-number">0x000001FA7D488900</span>, file <span class="hljs-string">&#x27;&lt;frozen importlib._bootstrap_external&gt;&#x27;</span>, line <span class="hljs-number">783</span>, code exec_module&gt;<br>&lt;frame at <span class="hljs-number">0x000001FA7D438BE0</span>, file <span class="hljs-string">&#x27;&lt;frozen importlib._bootstrap&gt;&#x27;</span>, line <span class="hljs-number">671</span>, code _load_unlocked&gt;<br>&lt;frame at <span class="hljs-number">0x000001FA7D48C440</span>, file <span class="hljs-string">&#x27;&lt;frozen importlib._bootstrap&gt;&#x27;</span>, line <span class="hljs-number">975</span>, code _find_and_load_unlocked&gt;<br>&lt;frame at <span class="hljs-number">0x000001FA7D4389F0</span>, file <span class="hljs-string">&#x27;&lt;frozen importlib._bootstrap&gt;&#x27;</span>, line <span class="hljs-number">991</span>, code _find_and_load&gt;<br>&lt;frame at <span class="hljs-number">0x000001FA7D4971F0</span>, file <span class="hljs-string">&#x27;&lt;frozen SierraTwo&gt;&#x27;</span>, line <span class="hljs-number">21</span>, code &lt;module&gt;&gt;<br>&lt;frame at <span class="hljs-number">0x000001FA7D12B440</span>, file <span class="hljs-string">&#x27;dist\\obf\\SierraTwo.py&#x27;</span>, line <span class="hljs-number">4</span>, code &lt;module&gt;&gt;<br></code></pre></td></tr></table></figure>

<p>bizi alakadar eden frame’in 0x000001FA7D4971F0’te ki frame oldugu bariz goruluyor. bundan mutevellit bu frame’i incelemek uzere bir yerlere tutturabiliriz.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">frame = inspect.stack()[<span class="hljs-number">6</span>]<br></code></pre></td></tr></table></figure>

<p>bildigimiz python’da bytecode’ta kullanilmak uzere degisken isimleri ve constant degerleri kod objesi ile birlikte geliyor.<br>yani constant degerler(fonksiyonlar gibi) hala kodumuzun icinde olabilir.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">c = frame.f_code<br><br><span class="hljs-keyword">for</span> idx, obj <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(c.co_consts):<br>    <span class="hljs-keyword">if</span> inspect.iscode(obj):<br>        print(idx, obj.co_name)<br></code></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs shell">5 prepare_shell<br>7 create_channel<br>9 next_channel<br>11 machine_info<br>15 uploader_thread<br>17 upload<br>19 respawn<br>21 handle_user_input<br>23 commands<br>25 listen<br>27 hide_process<br>32 protect_pytransform<br></code></pre></td></tr></table></figure>

<p>daha sonra ise bu fonksiyonlarda ki degiskenleri bastirabilirsek belki yararli bir seyler elde edebiliriz.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> idx, obj <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(c.co_consts):<br>    <span class="hljs-keyword">if</span> inspect.iscode(obj):<br>        print(idx, obj.co_name, obj.co_consts)<br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">5</span> prepare_shell (<span class="hljs-literal">None</span>, <span class="hljs-string">&#x27;channels&#x27;</span>, <span class="hljs-string">&#x27;channel&#x27;</span>, <span class="hljs-string">&#x27;id&#x27;</span>, (<span class="hljs-string">&#x27;channel&#x27;</span>, <span class="hljs-string">&#x27;users&#x27;</span>), (<span class="hljs-string">&#x27;channel&#x27;</span>, <span class="hljs-string">&#x27;text&#x27;</span>), (<span class="hljs-string">&#x27;channel&#x27;</span>,), <span class="hljs-string">&#x27;messages&#x27;</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;ts&#x27;</span>, (<span class="hljs-string">&#x27;channel&#x27;</span>, <span class="hljs-string">&#x27;timestamp&#x27;</span>))<br><span class="hljs-number">7</span> create_channel (<span class="hljs-literal">None</span>, (<span class="hljs-string">&#x27;name&#x27;</span>,))<br><span class="hljs-number">9</span> next_channel (<span class="hljs-literal">None</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;name&#x27;</span>, <span class="hljs-string">&#x27;-&#x27;</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>)<br><span class="hljs-number">11</span> machine_info (<span class="hljs-literal">None</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;Windows&#x27;</span>, <span class="hljs-string">&#x27;wmic csproduct get UUID&#x27;</span>, <span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-number">5</span>, <span class="hljs-string">&#x27;Linux&#x27;</span>, <span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;/etc/machine-id&#x27;</span>, <span class="hljs-string">&#x27;Darwin&#x27;</span>, <span class="hljs-string">&#x27;ioreg&#x27;</span>, <span class="hljs-string">&#x27;-d2&#x27;</span>, <span class="hljs-string">&#x27;-c&#x27;</span>, <span class="hljs-string">&#x27;IOPlatformExpertDevice&#x27;</span>, <span class="hljs-string">&#x27;|&#x27;</span>, <span class="hljs-string">&#x27;awk&#x27;</span>, <span class="hljs-string">&#x27;-F&#x27;</span>, <span class="hljs-string">&quot;&#x27;/IOPlatformUUID/&#123;print $(NF-1)&#125;&#x27;&quot;</span>, <span class="hljs-string">&#x27;unknown&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;` with the `&#x27;</span>, <span class="hljs-string">&#x27;` UUID connected.&#x27;</span>)<br><span class="hljs-number">15</span> uploader_thread (<span class="hljs-literal">None</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-literal">True</span>, (<span class="hljs-string">&#x27;file&#x27;</span>, <span class="hljs-string">&#x27;channels&#x27;</span>, <span class="hljs-string">&#x27;filename&#x27;</span>, <span class="hljs-string">&#x27;title&#x27;</span>), <span class="hljs-string">&#x27;Uploaded `&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;File not found.&#x27;</span>, <span class="hljs-literal">False</span>)<br><span class="hljs-number">17</span> upload (<span class="hljs-literal">None</span>, <span class="hljs-literal">True</span>, (<span class="hljs-string">&#x27;target&#x27;</span>, <span class="hljs-string">&#x27;daemon&#x27;</span>, <span class="hljs-string">&#x27;args&#x27;</span>), <span class="hljs-string">&#x27;Please wait while your file is uploaded.&#x27;</span>, (<span class="hljs-string">&#x27;channel&#x27;</span>, <span class="hljs-string">&#x27;text&#x27;</span>), <span class="hljs-string">&#x27;Cannot start uploader thread&#x27;</span>)<br><span class="hljs-number">19</span> respawn (<span class="hljs-literal">None</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;b0&#x27;</span>, <span class="hljs-string">&#x27;9b&#x27;</span>, <span class="hljs-string">&#x27;b1&#x27;</span>, <span class="hljs-string">&#x27;21&#x27;</span>, <span class="hljs-string">&#x27;6e&#x27;</span>, <span class="hljs-string">&#x27;10&#x27;</span>, <span class="hljs-string">&#x27;40&#x27;</span>, <span class="hljs-string">&#x27;3c&#x27;</span>, <span class="hljs-string">&#x27;72&#x27;</span>, <span class="hljs-string">&#x27;23&#x27;</span>, <span class="hljs-string">&#x27;6f&#x27;</span>, <span class="hljs-string">&#x27;16&#x27;</span>, <span class="hljs-string">&#x27;af&#x27;</span>, <span class="hljs-string">&#x27;14&#x27;</span>, <span class="hljs-string">&#x27;1a&#x27;</span>, <span class="hljs-string">&#x27;64&#x27;</span>, <span class="hljs-string">&#x27;12&#x27;</span>, <span class="hljs-string">&#x27;c8&#x27;</span>, <span class="hljs-string">&#x27;5b&#x27;</span>, <span class="hljs-string">&#x27;a6&#x27;</span>, <span class="hljs-string">&#x27;69&#x27;</span>, <span class="hljs-string">&#x27;b4&#x27;</span>, <span class="hljs-string">&#x27;6d&#x27;</span>, <span class="hljs-string">&#x27;74&#x27;</span>, <span class="hljs-string">&#x27;a2&#x27;</span>, <span class="hljs-string">&#x27;cf&#x27;</span>, <span class="hljs-string">&#x27;62&#x27;</span>, <span class="hljs-string">&#x27;52&#x27;</span>, <span class="hljs-string">&#x27;58&#x27;</span>, <span class="hljs-string">&#x27;30&#x27;</span>, <span class="hljs-string">&#x27;e0&#x27;</span>, <span class="hljs-string">&#x27;65&#x27;</span>, <span class="hljs-string">&#x27;db&#x27;</span>, <span class="hljs-string">&#x27;1e&#x27;</span>, <span class="hljs-string">&#x27;56&#x27;</span>, <span class="hljs-string">&#x27;73&#x27;</span>, <span class="hljs-string">&#x27;c4&#x27;</span>, <span class="hljs-string">&#x27;c2&#x27;</span>, <span class="hljs-string">&#x27;7e&#x27;</span>, <span class="hljs-string">&#x27;20&#x27;</span>, <span class="hljs-string">&#x27;24&#x27;</span>, <span class="hljs-string">&#x27;8e&#x27;</span>, <span class="hljs-string">&#x27;ce&#x27;</span>, <span class="hljs-string">&#x27;42&#x27;</span>, <span class="hljs-string">&#x27;17&#x27;</span>, <span class="hljs-string">&#x27;9a&#x27;</span>, <span class="hljs-string">&#x27;87&#x27;</span>, <span class="hljs-string">&#x27;fb&#x27;</span>, <span class="hljs-string">&#x27;dd&#x27;</span>, <span class="hljs-string">&#x27;eb&#x27;</span>, <span class="hljs-string">&#x27;ea&#x27;</span>, <span class="hljs-string">&#x27;25&#x27;</span>, <span class="hljs-string">&#x27;aa&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;a9&#x27;</span>, <span class="hljs-string">&#x27;2e&#x27;</span>, <span class="hljs-string">&#x27;78&#x27;</span>, <span class="hljs-string">&#x27;de&#x27;</span>, <span class="hljs-string">&#x27;66&#x27;</span>, <span class="hljs-string">&#x27;00&#x27;</span>, <span class="hljs-string">&#x27;85&#x27;</span>, <span class="hljs-string">&#x27;dc&#x27;</span>, <span class="hljs-string">&#x27;36&#x27;</span>, <span class="hljs-string">&#x27;32&#x27;</span>, <span class="hljs-string">&#x27;59&#x27;</span>, <span class="hljs-string">&#x27;ae&#x27;</span>, <span class="hljs-string">&#x27;3a&#x27;</span>, <span class="hljs-string">&#x27;2b&#x27;</span>, <span class="hljs-string">&#x27;29&#x27;</span>, <span class="hljs-string">&#x27;da&#x27;</span>, <span class="hljs-string">&#x27;d5&#x27;</span>, <span class="hljs-string">&#x27;f5&#x27;</span>, <span class="hljs-string">&#x27;2f&#x27;</span>, <span class="hljs-string">&#x27;2c&#x27;</span>, <span class="hljs-string">&#x27;fe&#x27;</span>, <span class="hljs-string">&#x27;cd&#x27;</span>, <span class="hljs-string">&#x27;2a&#x27;</span>, <span class="hljs-string">&#x27;90&#x27;</span>, <span class="hljs-string">&#x27;e6&#x27;</span>, <span class="hljs-string">&#x27;18&#x27;</span>, <span class="hljs-string">&#x27;75&#x27;</span>, <span class="hljs-string">&#x27;26&#x27;</span>, <span class="hljs-string">&#x27;68&#x27;</span>, <span class="hljs-string">&#x27;2d&#x27;</span>, <span class="hljs-string">&#x27;be&#x27;</span>, <span class="hljs-string">&#x27;35&#x27;</span>, <span class="hljs-string">&#x27;d0&#x27;</span>, <span class="hljs-string">&#x27;5a&#x27;</span>, <span class="hljs-string">&#x27;31&#x27;</span>, <span class="hljs-string">&#x27;22&#x27;</span>, <span class="hljs-string">&#x27;5f&#x27;</span>, <span class="hljs-string">&#x27;76&#x27;</span>, <span class="hljs-string">&#x27;27&#x27;</span>, <span class="hljs-string">&#x27;e1&#x27;</span>, <span class="hljs-string">&#x27;91&#x27;</span>, <span class="hljs-string">&#x27;45&#x27;</span>, <span class="hljs-string">&#x27;63&#x27;</span>, <span class="hljs-string">&#x27;94&#x27;</span>, <span class="hljs-string">&#x27;5d&#x27;</span>, <span class="hljs-string">&#x27;4c&#x27;</span>, <span class="hljs-string">&#x27;15&#x27;</span>, <span class="hljs-string">&#x27;ff&#x27;</span>, <span class="hljs-string">&#x27;e2&#x27;</span>, <span class="hljs-string">&#x27;5e&#x27;</span>, <span class="hljs-string">&#x27;28&#x27;</span>, <span class="hljs-string">&#x27;61&#x27;</span>, <span class="hljs-string">&#x27;ee&#x27;</span>, <span class="hljs-string">&#x27;f6&#x27;</span>, <span class="hljs-string">&#x27;08&#x27;</span>, <span class="hljs-string">&#x27;c3&#x27;</span>, <span class="hljs-string">&#x27;c7&#x27;</span>, <span class="hljs-string">&#x27;b6&#x27;</span>, <span class="hljs-string">&#x27;b5&#x27;</span>, <span class="hljs-string">&#x27;02&#x27;</span>, <span class="hljs-string">&#x27;55&#x27;</span>, <span class="hljs-string">&#x27;ef&#x27;</span>, <span class="hljs-string">&#x27;d9&#x27;</span>, <span class="hljs-string">&#x27;04&#x27;</span>, <span class="hljs-string">&#x27;ad&#x27;</span>, &lt;code <span class="hljs-built_in">object</span> varxor at <span class="hljs-number">0x0000023226DFF5B0</span>, file <span class="hljs-string">&quot;&lt;frozen SierraTwo&gt;&quot;</span>, line <span class="hljs-number">400</span>&gt;, <span class="hljs-string">&#x27;respawn.&lt;locals&gt;.varxor&#x27;</span>, <span class="hljs-string">&#x27;__main__&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">37</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;z&#x27;</span>)<br><span class="hljs-number">21</span> handle_user_input (<span class="hljs-literal">None</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;Error reading command output.&#x27;</span>, (<span class="hljs-string">&#x27;channel&#x27;</span>, <span class="hljs-string">&#x27;text&#x27;</span>), <span class="hljs-string">&#x27;The command did not return anything.&#x27;</span>, <span class="hljs-string">&#x27;`&#x27;</span>, <span class="hljs-string">&#x27;Output contains an illegal character.&#x27;</span>, <span class="hljs-number">0</span>, &lt;code <span class="hljs-built_in">object</span> &lt;listcomp&gt; at <span class="hljs-number">0x0000023226DFF660</span>, file <span class="hljs-string">&quot;&lt;frozen SierraTwo&gt;&quot;</span>, line <span class="hljs-number">440</span>&gt;, <span class="hljs-string">&#x27;handle_user_input.&lt;locals&gt;.&lt;listcomp&gt;&#x27;</span>, <span class="hljs-string">&#x27;```&#x27;</span>, <span class="hljs-string">&#x27;Output size is too big. If you are trying to read a file, try uploading it.&#x27;</span>, <span class="hljs-string">&#x27;Unknown error.&#x27;</span>)<br><span class="hljs-number">23</span> commands (<span class="hljs-literal">None</span>, <span class="hljs-string">&#x27;upload&#x27;</span>, <span class="hljs-string">&#x27; &#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-string">&#x27;cd&#x27;</span>, <span class="hljs-string">&#x27;`cd` complete.&#x27;</span>, (<span class="hljs-string">&#x27;channel&#x27;</span>, <span class="hljs-string">&#x27;text&#x27;</span>), <span class="hljs-string">&#x27;shell_exit&#x27;</span>, <span class="hljs-number">0</span>)<br><span class="hljs-number">25</span> listen (<span class="hljs-literal">None</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;randomval&#x27;</span>, (<span class="hljs-string">&#x27;channel&#x27;</span>,), <span class="hljs-number">0.8</span>, <span class="hljs-string">&#x27;messages&#x27;</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;client_msg_id&#x27;</span>, <span class="hljs-string">&#x27;text&#x27;</span>, <span class="hljs-number">0.3</span>)<br><span class="hljs-number">27</span> hide_process (<span class="hljs-literal">None</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;taskkill /PID &#x27;</span>, <span class="hljs-string">&#x27; /f&#x27;</span>)<br><span class="hljs-number">32</span> protect_pytransform (<span class="hljs-literal">None</span>, <span class="hljs-number">0</span>, &lt;code <span class="hljs-built_in">object</span> assert_builtin at <span class="hljs-number">0x0000023226DFF9D0</span>, file <span class="hljs-string">&quot;&lt;frozen SierraTwo&gt;&quot;</span>, line <span class="hljs-number">530</span>&gt;, <span class="hljs-string">&#x27;protect_pytransform.&lt;locals&gt;.assert_builtin&#x27;</span>, &lt;code <span class="hljs-built_in">object</span> check_obfuscated_script at <span class="hljs-number">0x0000023226DFFB30</span>, file <span class="hljs-string">&quot;&lt;frozen SierraTwo&gt;&quot;</span>, line <span class="hljs-number">536</span>&gt;, <span class="hljs-string">&#x27;protect_pytransform.&lt;locals&gt;.check_obfuscated_script&#x27;</span>, &lt;code <span class="hljs-built_in">object</span> check_mod_pytransform at <span class="hljs-number">0x0000023226DFFC90</span>, file <span class="hljs-string">&quot;&lt;frozen SierraTwo&gt;&quot;</span>, line <span class="hljs-number">545</span>&gt;, <span class="hljs-string">&#x27;protect_pytransform.&lt;locals&gt;.check_mod_pytransform&#x27;</span>, &lt;code <span class="hljs-built_in">object</span> check_lib_pytransform at <span class="hljs-number">0x0000023226DFFD40</span>, file <span class="hljs-string">&quot;&lt;frozen SierraTwo&gt;&quot;</span>, line <span class="hljs-number">559</span>&gt;, <span class="hljs-string">&#x27;protect_pytransform.&lt;locals&gt;.check_lib_pytransform&#x27;</span>)<br></code></pre></td></tr></table></figure>

<p>bir miktar supheli bir veri bulduk gibi.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">19</span> respawn (<span class="hljs-literal">None</span>, <span class="hljs-string">&#x27;&#x27;</span>, <span class="hljs-string">&#x27;b0&#x27;</span>, <span class="hljs-string">&#x27;9b&#x27;</span>, <span class="hljs-string">&#x27;b1&#x27;</span>, <span class="hljs-string">&#x27;21&#x27;</span>, <span class="hljs-string">&#x27;6e&#x27;</span>, <span class="hljs-string">&#x27;10&#x27;</span>, <span class="hljs-string">&#x27;40&#x27;</span>, <span class="hljs-string">&#x27;3c&#x27;</span>, <span class="hljs-string">&#x27;72&#x27;</span>, <span class="hljs-string">&#x27;23&#x27;</span>, <span class="hljs-string">&#x27;6f&#x27;</span>, <span class="hljs-string">&#x27;16&#x27;</span>, <span class="hljs-string">&#x27;af&#x27;</span>, <span class="hljs-string">&#x27;14&#x27;</span>, <span class="hljs-string">&#x27;1a&#x27;</span>, <span class="hljs-string">&#x27;64&#x27;</span>, <span class="hljs-string">&#x27;12&#x27;</span>, <span class="hljs-string">&#x27;c8&#x27;</span>, <span class="hljs-string">&#x27;5b&#x27;</span>, <span class="hljs-string">&#x27;a6&#x27;</span>, <span class="hljs-string">&#x27;69&#x27;</span>, <span class="hljs-string">&#x27;b4&#x27;</span>, <span class="hljs-string">&#x27;6d&#x27;</span>, <span class="hljs-string">&#x27;74&#x27;</span>, <span class="hljs-string">&#x27;a2&#x27;</span>, <span class="hljs-string">&#x27;cf&#x27;</span>, <span class="hljs-string">&#x27;62&#x27;</span>, <span class="hljs-string">&#x27;52&#x27;</span>, <span class="hljs-string">&#x27;58&#x27;</span>, <span class="hljs-string">&#x27;30&#x27;</span>, <span class="hljs-string">&#x27;e0&#x27;</span>, <span class="hljs-string">&#x27;65&#x27;</span>, <span class="hljs-string">&#x27;db&#x27;</span>, <span class="hljs-string">&#x27;1e&#x27;</span>, <span class="hljs-string">&#x27;56&#x27;</span>, <span class="hljs-string">&#x27;73&#x27;</span>, <span class="hljs-string">&#x27;c4&#x27;</span>, <span class="hljs-string">&#x27;c2&#x27;</span>, <span class="hljs-string">&#x27;7e&#x27;</span>, <span class="hljs-string">&#x27;20&#x27;</span>, <span class="hljs-string">&#x27;24&#x27;</span>, <span class="hljs-string">&#x27;8e&#x27;</span>, <span class="hljs-string">&#x27;ce&#x27;</span>, <span class="hljs-string">&#x27;42&#x27;</span>, <span class="hljs-string">&#x27;17&#x27;</span>, <span class="hljs-string">&#x27;9a&#x27;</span>, <span class="hljs-string">&#x27;87&#x27;</span>, <span class="hljs-string">&#x27;fb&#x27;</span>, <span class="hljs-string">&#x27;dd&#x27;</span>, <span class="hljs-string">&#x27;eb&#x27;</span>, <span class="hljs-string">&#x27;ea&#x27;</span>, <span class="hljs-string">&#x27;25&#x27;</span>, <span class="hljs-string">&#x27;aa&#x27;</span>, <span class="hljs-string">&#x27;fa&#x27;</span>, <span class="hljs-string">&#x27;a9&#x27;</span>, <span class="hljs-string">&#x27;2e&#x27;</span>, <span class="hljs-string">&#x27;78&#x27;</span>, <span class="hljs-string">&#x27;de&#x27;</span>, <span class="hljs-string">&#x27;66&#x27;</span>, <span class="hljs-string">&#x27;00&#x27;</span>, <span class="hljs-string">&#x27;85&#x27;</span>, <span class="hljs-string">&#x27;dc&#x27;</span>, <span class="hljs-string">&#x27;36&#x27;</span>, <span class="hljs-string">&#x27;32&#x27;</span>, <span class="hljs-string">&#x27;59&#x27;</span>, <span class="hljs-string">&#x27;ae&#x27;</span>, <span class="hljs-string">&#x27;3a&#x27;</span>, <span class="hljs-string">&#x27;2b&#x27;</span>, <span class="hljs-string">&#x27;29&#x27;</span>, <span class="hljs-string">&#x27;da&#x27;</span>, <span class="hljs-string">&#x27;d5&#x27;</span>, <span class="hljs-string">&#x27;f5&#x27;</span>, <span class="hljs-string">&#x27;2f&#x27;</span>, <span class="hljs-string">&#x27;2c&#x27;</span>, <span class="hljs-string">&#x27;fe&#x27;</span>, <span class="hljs-string">&#x27;cd&#x27;</span>, <span class="hljs-string">&#x27;2a&#x27;</span>, <span class="hljs-string">&#x27;90&#x27;</span>, <span class="hljs-string">&#x27;e6&#x27;</span>, <span class="hljs-string">&#x27;18&#x27;</span>, <span class="hljs-string">&#x27;75&#x27;</span>, <span class="hljs-string">&#x27;26&#x27;</span>, <span class="hljs-string">&#x27;68&#x27;</span>, <span class="hljs-string">&#x27;2d&#x27;</span>, <span class="hljs-string">&#x27;be&#x27;</span>, <span class="hljs-string">&#x27;35&#x27;</span>, <span class="hljs-string">&#x27;d0&#x27;</span>, <span class="hljs-string">&#x27;5a&#x27;</span>, <span class="hljs-string">&#x27;31&#x27;</span>, <span class="hljs-string">&#x27;22&#x27;</span>, <span class="hljs-string">&#x27;5f&#x27;</span>, <span class="hljs-string">&#x27;76&#x27;</span>, <span class="hljs-string">&#x27;27&#x27;</span>, <span class="hljs-string">&#x27;e1&#x27;</span>, <span class="hljs-string">&#x27;91&#x27;</span>, <span class="hljs-string">&#x27;45&#x27;</span>, <span class="hljs-string">&#x27;63&#x27;</span>, <span class="hljs-string">&#x27;94&#x27;</span>, <span class="hljs-string">&#x27;5d&#x27;</span>, <span class="hljs-string">&#x27;4c&#x27;</span>, <span class="hljs-string">&#x27;15&#x27;</span>, <span class="hljs-string">&#x27;ff&#x27;</span>, <span class="hljs-string">&#x27;e2&#x27;</span>, <span class="hljs-string">&#x27;5e&#x27;</span>, <span class="hljs-string">&#x27;28&#x27;</span>, <span class="hljs-string">&#x27;61&#x27;</span>, <span class="hljs-string">&#x27;ee&#x27;</span>, <span class="hljs-string">&#x27;f6&#x27;</span>, <span class="hljs-string">&#x27;08&#x27;</span>, <span class="hljs-string">&#x27;c3&#x27;</span>, <span class="hljs-string">&#x27;c7&#x27;</span>, <span class="hljs-string">&#x27;b6&#x27;</span>, <span class="hljs-string">&#x27;b5&#x27;</span>, <span class="hljs-string">&#x27;02&#x27;</span>, <span class="hljs-string">&#x27;55&#x27;</span>, <span class="hljs-string">&#x27;ef&#x27;</span>, <span class="hljs-string">&#x27;d9&#x27;</span>, <span class="hljs-string">&#x27;04&#x27;</span>, <span class="hljs-string">&#x27;ad&#x27;</span>, &lt;code <span class="hljs-built_in">object</span> varxor at <span class="hljs-number">0x0000023226DFF5B0</span>, file <span class="hljs-string">&quot;&lt;frozen SierraTwo&gt;&quot;</span>, line <span class="hljs-number">400</span>&gt;, <span class="hljs-string">&#x27;respawn.&lt;locals&gt;.varxor&#x27;</span>, <span class="hljs-string">&#x27;__main__&#x27;</span>, <span class="hljs-number">1</span>, <span class="hljs-number">37</span>, <span class="hljs-string">&#x27;a&#x27;</span>, <span class="hljs-string">&#x27;b&#x27;</span>, <span class="hljs-string">&#x27;z&#x27;</span>)<br></code></pre></td></tr></table></figure>
<p>sonucta bu fonksiyon bir codeobject. yani exec calistirabiliriz.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">frame = inspect.stack()[<span class="hljs-number">6</span>].frame<br>respawn = frame.f_code.co_consts[<span class="hljs-number">19</span>]<br>print(exec(respawn))<br></code></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">None<br></code></pre></td></tr></table></figure>
<p>ama uzucu bir sekilde bu fonksiyon bize bir sey dondurmuyor. <a target="_blank" rel="noopener" href="https://docs.python.org/3/library/dis.html"><strong>dis</strong></a> kutuphanesini kullanarak bytecode’u disassemble edebiliriz.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> dis<br>dis.dis(respawn)<br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">167</span>           <span class="hljs-number">0</span> JUMP_ABSOLUTE           <span class="hljs-number">18</span><br>              <span class="hljs-number">2</span> NOP<br><br><span class="hljs-number">168</span>           <span class="hljs-number">4</span> NOP<br>        &gt;&gt;    <span class="hljs-number">6</span> POP_BLOCK<br><br><span class="hljs-number">169</span>           <span class="hljs-number">8</span> BEGIN_FINALLY<br>             <span class="hljs-number">10</span> NOP<br><br><span class="hljs-number">170</span>          <span class="hljs-number">12</span> NOP<br>             <span class="hljs-number">14</span> EXTENDED_ARG             <span class="hljs-number">4</span><br><br><span class="hljs-number">171</span>          <span class="hljs-number">16</span> JUMP_ABSOLUTE         <span class="hljs-number">1066</span><br>        &gt;&gt;   <span class="hljs-number">18</span> LOAD_GLOBAL              <span class="hljs-number">2</span> (__armor_enter__)<br><br><span class="hljs-number">172</span>          <span class="hljs-number">20</span> CALL_FUNCTION            <span class="hljs-number">0</span><br>             <span class="hljs-number">22</span> POP_TOP<br><br><span class="hljs-number">173</span>          <span class="hljs-number">24</span> NOP<br>             <span class="hljs-number">26</span> NOP<br><br><span class="hljs-number">174</span>          <span class="hljs-number">28</span> EXTENDED_ARG             <span class="hljs-number">4</span><br>             <span class="hljs-number">30</span> SETUP_FINALLY         <span class="hljs-number">1034</span> (to <span class="hljs-number">1066</span>)<br><br><span class="hljs-number">175</span>          <span class="hljs-number">32</span> INPLACE_POWER<br>             <span class="hljs-number">34</span> NOP<br><br><span class="hljs-number">176</span>     &gt;&gt;   <span class="hljs-number">36</span> MAP_ADD                 <span class="hljs-number">40</span><br>             <span class="hljs-number">38</span> &lt;<span class="hljs-number">222</span>&gt;                  <span class="hljs-number">175</span><br>                ...<br>                ...<br>                ...<br>                ...<br>Traceback (most recent call last):<br>  File <span class="hljs-string">&quot;&lt;dist\obf\SierraTwo.py&gt;&quot;</span>, line <span class="hljs-number">4</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>  File <span class="hljs-string">&quot;&lt;frozen SierraTwo&gt;&quot;</span>, line <span class="hljs-number">21</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>  File <span class="hljs-string">&quot;ayskrem\slack.py&quot;</span>, line <span class="hljs-number">38</span>, <span class="hljs-keyword">in</span> &lt;module&gt;<br>    dis.dis(respawn)<br>  File <span class="hljs-string">&quot;xi\git\c\cpython\lib\dis.py&quot;</span>, line <span class="hljs-number">79</span>, <span class="hljs-keyword">in</span> dis<br>    _disassemble_recursive(x, file=file, depth=depth)<br>  File <span class="hljs-string">&quot;xi\git\c\cpython\lib\dis.py&quot;</span>, line <span class="hljs-number">373</span>, <span class="hljs-keyword">in</span> _disassemble_recursive<br>    disassemble(co, file=file)<br>  File <span class="hljs-string">&quot;xi\git\c\cpython\lib\dis.py&quot;</span>, line <span class="hljs-number">369</span>, <span class="hljs-keyword">in</span> disassemble<br>    _disassemble_bytes(co.co_code, lasti, co.co_varnames, co.co_names,<br>  File <span class="hljs-string">&quot;xi\git\c\cpython\lib\dis.py&quot;</span>, line <span class="hljs-number">401</span>, <span class="hljs-keyword">in</span> _disassemble_bytes<br>    <span class="hljs-keyword">for</span> instr <span class="hljs-keyword">in</span> _get_instructions_bytes(code, varnames, names,<br>  File <span class="hljs-string">&quot;xi\git\c\cpython\lib\dis.py&quot;</span>, line <span class="hljs-number">340</span>, <span class="hljs-keyword">in</span> _get_instructions_bytes<br>    argval, argrepr = _get_name_info(arg, names)<br>  File <span class="hljs-string">&quot;xi\git\c\cpython\lib\dis.py&quot;</span>, line <span class="hljs-number">304</span>, <span class="hljs-keyword">in</span> _get_name_info<br>    argval = name_list[name_index]<br>IndexError: <span class="hljs-built_in">tuple</span> index out of <span class="hljs-built_in">range</span><br></code></pre></td></tr></table></figure>

<p>fakat malesef hayal kirikligina ugradik. pyarmor’un dokumantasyonuna bakar isek bunun <a target="_blank" rel="noopener" href="https://pyarmor.readthedocs.io/en/latest/mode.html?highlight=__armor_enter__#wrap-mode">wrap-mode</a> ozelligi oldugunu gorebiliriz</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python">LOAD_GLOBALS    N (__armor_enter__)     N = length of co_consts<br>CALL_FUNCTION   <span class="hljs-number">0</span><br>POP_TOP<br>SETUP_FINALLY   X (jump to wrap footer) X = size of original byte code<br><br>Here it<span class="hljs-string">&#x27;s obfuscated bytecode of original function</span><br><span class="hljs-string"></span><br><span class="hljs-string">LOAD_GLOBALS    N + 1 (__armor_exit__)</span><br><span class="hljs-string">CALL_FUNCTION   0</span><br><span class="hljs-string">POP_TOP</span><br><span class="hljs-string">END_FINALLY</span><br></code></pre></td></tr></table></figure>
<p>su yapiya gore <strong>__armor_enter__</strong> kendi referansini alip aradaki bytecode araligini guncelliyor.</p>
<p>bu durumda yapabilecegimiz iki durum var. ilki cpython’a ufak bir patch atmak digeri ise extension’u/library’i reverslemek. buyuk ihtimalle cpython’u patchlemek daha kolay ve hizli olacaktir.</p>
<p>cpython’da bildigimiz uzere bytecode’lar <strong>ceval.c</strong> uzerinde isleniyor. sorunumuz polimorfik bir codeobject oldugundan dolayi sadece calisan bytecodelari dumplayacagiz. yani switch_case’den hemen once byte-codelari dumplamamiz yeterlidir.</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-meta">@@ -759,6 +759,11 @@</span> _PyEval_EvalFrameDefault(PyFrameObject *f, int throwflag)<br>     _Py_atomic_int * const eval_breaker = &amp;ceval-&gt;eval_breaker;<br>     PyCodeObject *co;<br><br><span class="hljs-addition">+    FILE *a_logger;</span><br><span class="hljs-addition">+    int logger_flag;</span><br><span class="hljs-addition">+    if ((logger_flag = PyUnicode_CompareWithASCIIString(f-&gt;f_code-&gt;co_name, &quot;respawn&quot;) == 0)) &#123;</span><br><span class="hljs-addition">+        a_logger = fopen(&quot;xi\respawn.bin&quot;, &quot;wb&quot;);</span><br><span class="hljs-addition">+    &#125;</span><br>     /* when tracing we set things up so that<br><br>            not (instr_lb &lt;= current_bytecode_offset &lt; instr_ub)<br><span class="hljs-meta">@@ -1077,9 +1082,12 @@</span> _PyEval_EvalFrameDefault(PyFrameObject *f, int throwflag)<br> /* Start of code */<br><br>     /* push frame */<br><span class="hljs-deletion">-    if (Py_EnterRecursiveCall(&quot;&quot;))</span><br><span class="hljs-addition">+    if (Py_EnterRecursiveCall(&quot;&quot;))&#123;</span><br><span class="hljs-addition">+        if (logger_flag) &#123;</span><br><span class="hljs-addition">+            fclose(a_logger);</span><br><span class="hljs-addition">+       &#125;</span><br>         return NULL;<br><span class="hljs-deletion">-</span><br><span class="hljs-addition">+    &#125;</span><br>     tstate-&gt;frame = f;<br><br>     if (tstate-&gt;use_tracing) &#123;<br><span class="hljs-meta">@@ -1319,6 +1327,16 @@</span> main_loop:<br>             &#125;<br>         &#125;<br> #endif<br><span class="hljs-addition">+       if (logger_flag) &#123;</span><br><span class="hljs-addition">+          if (HAS_ARG(opcode)) &#123;</span><br><span class="hljs-addition">+               fputc(opcode, a_logger);</span><br><span class="hljs-addition">+               fputc(oparg, a_logger);</span><br><span class="hljs-addition">+          &#125;</span><br><span class="hljs-addition">+           else &#123;</span><br><span class="hljs-addition">+              fputc(opcode, a_logger);</span><br><span class="hljs-addition">+              fputc(0, a_logger);</span><br><span class="hljs-addition">+          &#125;</span><br><span class="hljs-addition">+       &#125;</span><br><br>         switch (opcode) &#123;<br><br><span class="hljs-meta">@@ -3813,7 +3831,9 @@</span> exit_eval_frame:<br>     Py_LeaveRecursiveCall();<br>     f-&gt;f_executing = 0;<br>     tstate-&gt;frame = f-&gt;f_back;<br><span class="hljs-deletion">-</span><br><span class="hljs-addition">+    if (logger_flag)&#123;</span><br><span class="hljs-addition">+       fclose(a_logger);</span><br><span class="hljs-addition">+    &#125;</span><br>     return _Py_CheckFunctionResult(NULL, retval, &quot;PyEval_EvalFrameEx&quot;);<br> &#125;<br></code></pre></td></tr></table></figure>

<p>peki kodumuzu guncelledik. respawn fonksiyonunu bir defa calistirmamiz gerekiyor.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">exec(respawn)<br></code></pre></td></tr></table></figure>

<p>simdi <strong>respawn.bin</strong> dosyasina goz atabiliriz.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> dis<br>dis.dis(respawn.replace(co_code=<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;respawn.bin&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>).read()), depth=<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">167</span>           <span class="hljs-number">0</span> JUMP_ABSOLUTE           <span class="hljs-number">18</span><br>              <span class="hljs-number">2</span> LOAD_GLOBAL              <span class="hljs-number">2</span> (__armor_enter__)<br><br><span class="hljs-number">168</span>           <span class="hljs-number">4</span> CALL_FUNCTION            <span class="hljs-number">0</span><br>        &gt;&gt;    <span class="hljs-number">6</span> POP_TOP<br><br><span class="hljs-number">169</span>           <span class="hljs-number">8</span> NOP<br>             <span class="hljs-number">10</span> NOP<br><br><span class="hljs-number">170</span>          <span class="hljs-number">12</span> EXTENDED_ARG             <span class="hljs-number">4</span><br>             <span class="hljs-number">14</span> SETUP_FINALLY         <span class="hljs-number">1034</span> (to <span class="hljs-number">1050</span>)<br><br><span class="hljs-number">171</span>          <span class="hljs-number">16</span> LOAD_CONST               <span class="hljs-number">1</span> (<span class="hljs-string">&#x27;&#x27;</span>)<br>        &gt;&gt;   <span class="hljs-number">18</span> STORE_FAST               <span class="hljs-number">0</span> (z2)<br><br><span class="hljs-number">172</span>          <span class="hljs-number">20</span> LOAD_CONST               <span class="hljs-number">2</span> (<span class="hljs-string">&#x27;b0&#x27;</span>)<br>             <span class="hljs-number">22</span> STORE_FAST               <span class="hljs-number">1</span> (t6)<br><br><span class="hljs-number">173</span>          <span class="hljs-number">24</span> LOAD_CONST               <span class="hljs-number">3</span> (<span class="hljs-string">&#x27;9b&#x27;</span>)<br>             <span class="hljs-number">26</span> STORE_FAST               <span class="hljs-number">2</span> (f23)<br><br><span class="hljs-number">174</span>          <span class="hljs-number">28</span> LOAD_CONST               <span class="hljs-number">4</span> (<span class="hljs-string">&#x27;b1&#x27;</span>)<br>             <span class="hljs-number">30</span> STORE_FAST               <span class="hljs-number">3</span> (u46)<br>                ...<br>                ...<br>                ...<br>            <span class="hljs-number">938</span> STORE_FAST             <span class="hljs-number">229</span> (a67)<br>            <span class="hljs-number">940</span> LOAD_CONST             <span class="hljs-number">121</span> (&lt;code <span class="hljs-built_in">object</span> varxor at <span class="hljs-number">0x000001E90F0FF5B0</span>, file <span class="hljs-string">&quot;&lt;frozen SierraTwo&gt;&quot;</span>, line <span class="hljs-number">400</span>&gt;)<br><br><span class="hljs-number">407</span>         <span class="hljs-number">942</span> LOAD_CONST             <span class="hljs-number">122</span> (<span class="hljs-string">&#x27;respawn.&lt;locals&gt;.varxor&#x27;</span>)<br>            <span class="hljs-number">944</span> MAKE_FUNCTION            <span class="hljs-number">0</span><br><br><span class="hljs-number">408</span>         <span class="hljs-number">946</span> STORE_FAST             <span class="hljs-number">230</span> (varxor)<br>            <span class="hljs-number">948</span> LOAD_GLOBAL              <span class="hljs-number">0</span> (__name__)<br>            <span class="hljs-number">950</span> LOAD_CONST             <span class="hljs-number">123</span> (<span class="hljs-string">&#x27;__main__&#x27;</span>)<br>            <span class="hljs-number">952</span> COMPARE_OP               <span class="hljs-number">2</span> (==)<br>            <span class="hljs-number">954</span> EXTENDED_ARG             <span class="hljs-number">4</span><br><br><span class="hljs-number">409</span>         <span class="hljs-number">956</span> POP_JUMP_IF_FALSE     <span class="hljs-number">1062</span><br>            <span class="hljs-number">958</span> LOAD_CONST               <span class="hljs-number">0</span> (<span class="hljs-literal">None</span>)<br>            <span class="hljs-number">960</span> JUMP_ABSOLUTE            <span class="hljs-number">6</span><br>            <span class="hljs-number">962</span> POP_BLOCK<br>            <span class="hljs-number">964</span> BEGIN_FINALLY<br>            <span class="hljs-number">966</span> NOP<br>            <span class="hljs-number">968</span> NOP<br>            <span class="hljs-number">970</span> EXTENDED_ARG             <span class="hljs-number">4</span><br><br><span class="hljs-number">410</span>         <span class="hljs-number">972</span> JUMP_ABSOLUTE         <span class="hljs-number">1066</span><br>            <span class="hljs-number">974</span> LOAD_GLOBAL              <span class="hljs-number">3</span> (__armor_exit__)<br>            <span class="hljs-number">976</span> CALL_FUNCTION            <span class="hljs-number">0</span><br>            <span class="hljs-number">978</span> POP_TOP<br>            <span class="hljs-number">980</span> END_FINALLY<br>            <span class="hljs-number">982</span> RETURN_VALUE<br></code></pre></td></tr></table></figure>

<p>varxor’ada bakalim fakat varxor’da packli. tekrardan dumplamaya eriniyorsak(-ki ben erindim) elimizle bir kac deneme yapabiliriz.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">varxor</span>(<span class="hljs-params">a, b</span>):</span> <span class="hljs-keyword">pass</span><br>varxor.__code__ = respawn.co_consts[respawn.co_consts.index(<span class="hljs-string">&#x27;ad&#x27;</span>) + <span class="hljs-number">1</span>]<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>varxor(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)<br>*** TypeError: <span class="hljs-string">&#x27;int&#x27;</span> <span class="hljs-built_in">object</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> iterable<br><span class="hljs-meta">&gt;&gt;&gt; </span>varxor(<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>)<br><span class="hljs-string">&#x27;3&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>varxor(<span class="hljs-string">&#x27;23123AB&#x27;</span>, <span class="hljs-string">&#x27;F0&#x27;</span>)<br><span class="hljs-string">&#x27;d3&#x27;</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>varxor(<span class="hljs-string">&#x27;23123AB&#x27;</span>, <span class="hljs-string">&#x27;&#x27;</span>)<br><span class="hljs-string">&#x27;&#x27;</span><br></code></pre></td></tr></table></figure>
<p>yani varxor kabaca bize hexstring xor yapiyor. suanlik boyle kabul edilebilir gibi. hata olursa tekrar bir goz atariz</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">lambda</span> a, b: a <span class="hljs-keyword">and</span> b <span class="hljs-keyword">and</span> <span class="hljs-built_in">hex</span>(<span class="hljs-built_in">int</span>(a, <span class="hljs-number">16</span>) ^ <span class="hljs-built_in">int</span>(b, <span class="hljs-number">16</span>))[<span class="hljs-number">2</span>:]<br></code></pre></td></tr></table></figure>

<p>bayagi bir degisken olsuturduktan sonra eger main ise calistirdigi bir kisim bulunuyor. bundan dolayi onu main olduguna dair ikna etmemiz gerekiyor.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">exec(respawn, exec(respawn, &#123;<span class="hljs-string">&quot;__name__&quot;</span>: <span class="hljs-string">&quot;__main__&quot;</span>&#125;))<br>dis.dis(respawn.replace(co_code=<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;respawn.bin&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>).read()), depth=<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure>
<p>(kodun tamami degil, sadece eksik kismi budur)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">408</span>         <span class="hljs-number">946</span> STORE_FAST             <span class="hljs-number">230</span> (varxor)<br>            <span class="hljs-number">948</span> LOAD_GLOBAL              <span class="hljs-number">0</span> (__name__)<br>            <span class="hljs-number">950</span> LOAD_CONST             <span class="hljs-number">123</span> (<span class="hljs-string">&#x27;__main__&#x27;</span>)<br>            <span class="hljs-number">952</span> COMPARE_OP               <span class="hljs-number">2</span> (==)<br>            <span class="hljs-number">954</span> EXTENDED_ARG             <span class="hljs-number">4</span><br><br><span class="hljs-number">409</span>         <span class="hljs-number">956</span> POP_JUMP_IF_FALSE     <span class="hljs-number">1062</span><br>            <span class="hljs-number">958</span> LOAD_CONST             <span class="hljs-number">124</span> (<span class="hljs-number">1</span>)<br>            <span class="hljs-number">960</span> STORE_FAST             <span class="hljs-number">231</span> (i)<br>            <span class="hljs-number">962</span> LOAD_FAST              <span class="hljs-number">231</span> (i)<br>            <span class="hljs-number">964</span> LOAD_CONST             <span class="hljs-number">125</span> (<span class="hljs-number">37</span>)<br>            <span class="hljs-number">966</span> COMPARE_OP               <span class="hljs-number">1</span> (&lt;=)<br>            <span class="hljs-number">968</span> EXTENDED_ARG             <span class="hljs-number">4</span><br>            <span class="hljs-number">970</span> POP_JUMP_IF_FALSE     <span class="hljs-number">1062</span><br><br><span class="hljs-number">410</span>         <span class="hljs-number">972</span> LOAD_GLOBAL              <span class="hljs-number">1</span> (<span class="hljs-built_in">locals</span>)<br>            <span class="hljs-number">974</span> CALL_FUNCTION            <span class="hljs-number">0</span><br>            <span class="hljs-number">976</span> LOAD_CONST             <span class="hljs-number">126</span> (<span class="hljs-string">&#x27;a&#x27;</span>)<br>        &gt;&gt;  <span class="hljs-number">978</span> LOAD_FAST              <span class="hljs-number">231</span> (i)<br>            <span class="hljs-number">980</span> FORMAT_VALUE             <span class="hljs-number">0</span><br>            <span class="hljs-number">982</span> BUILD_STRING             <span class="hljs-number">2</span><br>            <span class="hljs-number">984</span> BINARY_SUBSCR<br>            <span class="hljs-number">986</span> STORE_FAST             <span class="hljs-number">232</span> (a)<br><br><span class="hljs-number">411</span>         <span class="hljs-number">988</span> LOAD_GLOBAL              <span class="hljs-number">1</span> (<span class="hljs-built_in">locals</span>)<br>            <span class="hljs-number">990</span> CALL_FUNCTION            <span class="hljs-number">0</span><br>            <span class="hljs-number">992</span> LOAD_CONST             <span class="hljs-number">127</span> (<span class="hljs-string">&#x27;b&#x27;</span>)<br>            <span class="hljs-number">994</span> LOAD_FAST              <span class="hljs-number">231</span> (i)<br>            <span class="hljs-number">996</span> FORMAT_VALUE             <span class="hljs-number">0</span><br>            <span class="hljs-number">998</span> BUILD_STRING             <span class="hljs-number">2</span><br>           <span class="hljs-number">1000</span> BINARY_SUBSCR<br>           <span class="hljs-number">1002</span> STORE_FAST             <span class="hljs-number">233</span> (b)<br><br><span class="hljs-number">413</span>        <span class="hljs-number">1004</span> LOAD_GLOBAL              <span class="hljs-number">1</span> (<span class="hljs-built_in">locals</span>)<br>           <span class="hljs-number">1006</span> CALL_FUNCTION            <span class="hljs-number">0</span><br>           <span class="hljs-number">1008</span> LOAD_CONST             <span class="hljs-number">128</span> (<span class="hljs-string">&#x27;z&#x27;</span>)<br>           <span class="hljs-number">1010</span> LOAD_FAST              <span class="hljs-number">231</span> (i)<br>           <span class="hljs-number">1012</span> FORMAT_VALUE             <span class="hljs-number">0</span><br>           <span class="hljs-number">1014</span> BUILD_STRING             <span class="hljs-number">2</span><br>           <span class="hljs-number">1016</span> BINARY_SUBSCR<br><br><span class="hljs-number">415</span>        <span class="hljs-number">1018</span> STORE_FAST             <span class="hljs-number">234</span> (z)<br>           <span class="hljs-number">1020</span> LOAD_FAST              <span class="hljs-number">234</span> (z)<br>           <span class="hljs-number">1022</span> LOAD_FAST              <span class="hljs-number">230</span> (varxor)<br>           <span class="hljs-number">1024</span> LOAD_FAST              <span class="hljs-number">232</span> (a)<br>           <span class="hljs-number">1026</span> LOAD_FAST              <span class="hljs-number">233</span> (b)<br>           <span class="hljs-number">1028</span> CALL_FUNCTION            <span class="hljs-number">2</span><br>           <span class="hljs-number">1030</span> INPLACE_ADD<br>           <span class="hljs-number">1032</span> STORE_FAST             <span class="hljs-number">234</span> (z)<br>           <span class="hljs-number">1034</span> LOAD_FAST              <span class="hljs-number">231</span> (i)<br>           <span class="hljs-number">1036</span> LOAD_CONST             <span class="hljs-number">124</span> (<span class="hljs-number">1</span>)<br>           <span class="hljs-number">1038</span> INPLACE_ADD<br>           <span class="hljs-number">1040</span> STORE_FAST             <span class="hljs-number">231</span> (i)<br>           <span class="hljs-number">1042</span> EXTENDED_ARG             <span class="hljs-number">3</span><br>           <span class="hljs-number">1044</span> JUMP_ABSOLUTE          <span class="hljs-number">978</span><br></code></pre></td></tr></table></figure>

<p>yukaridaki bytecodun tahmini karsiligi su sekilde</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">while</span> i &lt;= <span class="hljs-number">37</span>:<br>    a = <span class="hljs-built_in">locals</span>()[<span class="hljs-string">f&quot;a<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>]<br>    b = <span class="hljs-built_in">locals</span>()[<span class="hljs-string">f&quot;b<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>]<br>    z = <span class="hljs-built_in">locals</span>()[<span class="hljs-string">f&quot;z<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>]<br>    z += varxor(a, b)<br>    i += <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure>

<p>locals dinamik bir yapi fakat degiskenlere sadece bir defa atama gerceklestiriliyor. <strong>dis</strong> kutuphanesinden <strong>get_instruction</strong> fonksiyonunu kullanip kod uzerinden hizlica construct edilebilir</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> opcode<br><span class="hljs-keyword">from</span> contextlib <span class="hljs-keyword">import</span> suppress<br><br>STORE_FAST = opcode.opmap[<span class="hljs-string">&quot;STORE_FAST&quot;</span>]<br>LOAD_CONST = opcode.opmap[<span class="hljs-string">&quot;LOAD_CONST&quot;</span>]<br><br>result = <span class="hljs-string">&quot;&quot;</span><br>_locals = <span class="hljs-built_in">dict</span>()<br><br><span class="hljs-keyword">for</span> instruction <span class="hljs-keyword">in</span> dis.get_instructions(respawn.replace(co_code=<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;respawn.bin&quot;</span>, <span class="hljs-string">&quot;rb&quot;</span>).read())):<br>    <span class="hljs-keyword">if</span> instruction.opcode == STORE_FAST:<br>        _locals[instruction.argval] = last.argval <br>    <span class="hljs-keyword">elif</span> instruction.opcode == LOAD_CONST:<br>        last = instruction<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>, <span class="hljs-number">37</span>):<br>    a = _locals[<span class="hljs-string">f&quot;a<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>]<br>    b = _locals[<span class="hljs-string">f&quot;b<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>]<br>    z = _locals[<span class="hljs-string">f&quot;z<span class="hljs-subst">&#123;i&#125;</span>&quot;</span>]<br>    result += z + (a <span class="hljs-keyword">and</span> b <span class="hljs-keyword">and</span> <span class="hljs-built_in">hex</span>(<span class="hljs-built_in">int</span>(a, <span class="hljs-number">16</span>) ^ <span class="hljs-built_in">int</span>(b, <span class="hljs-number">16</span>))[<span class="hljs-number">2</span>:])<br>print(<span class="hljs-built_in">bytearray</span>.fromhex(result[:-<span class="hljs-number">1</span>]).decode())<br></code></pre></td></tr></table></figure>

<p>ve flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">flag&#123;S3ri0uSlY_Y0u_s0Lv3D_tH1s_t00&#125;<br></code></pre></td></tr></table></figure>

<h4 id="bu-arada-gunumun-cogunlugunu-gecirdigim-cpython’u-ogrenmeme-vesile-olan-big-code’a-tesekkurlerimi-iletiyorum"><a href="#bu-arada-gunumun-cogunlugunu-gecirdigim-cpython’u-ogrenmeme-vesile-olan-big-code’a-tesekkurlerimi-iletiyorum" class="headerlink" title="bu arada gunumun cogunlugunu gecirdigim cpython’u ogrenmeme vesile olan big code’a tesekkurlerimi iletiyorum"></a>bu arada gunumun cogunlugunu gecirdigim cpython’u ogrenmeme vesile olan big code’a tesekkurlerimi iletiyorum</h4><div id="paginator"></div></div><div id="post-footer"><hr><a href="/2019/04/28/JS-Safe-3-0-Google-CTF/">JS Safe 3.0 - Google CTF Next →</a><hr></div><div id="bottom-btn"><a id="to-index" href="#post-index" title="index">≡</a><a id="to-top" href="#post-title" title="to top">∧</a></div></div></article><aside><div id="about"><a href="/" id="logo"><img src="/img/logo.webp" alt="Logo"></a><h1 id="Dr"><a href="/">anal kurs merkezi</a></h1></div><div id="aside-block"><h1>INDEX</h1><div id="post-index"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#analiz"><span class="toc-number">1.</span> <span class="toc-text">analiz</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#aksiyon-alimi"><span class="toc-number">2.</span> <span class="toc-text">aksiyon alimi</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#bu-arada-gunumun-cogunlugunu-gecirdigim-cpython%E2%80%99u-ogrenmeme-vesile-olan-big-code%E2%80%99a-tesekkurlerimi-iletiyorum"><span class="toc-number">2.0.1.</span> <span class="toc-text">bu arada gunumun cogunlugunu gecirdigim cpython’u ogrenmeme vesile olan big code’a tesekkurlerimi iletiyorum</span></a></li></ol></li></ol></li></ol></div></div><footer><nobr>published with&nbsp;<a target="_blank" rel="noopener" href="http://hexo.io">Hexo&nbsp;</a></nobr><wbr><nobr>Theme&nbsp;<a target="_blank" rel="noopener" href="https://github.com/Yue-plus/hexo-theme-arknights">Arknight&nbsp;</a></nobr><wbr><nobr>by&nbsp;<a target="_blank" rel="noopener" href="https://github.com/Yue-plus">Yue_plus</a></nobr></footer></aside></main><script src="/js/arknights.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/highlight.js/10.1.2/highlight.min.js"></script></body></html>